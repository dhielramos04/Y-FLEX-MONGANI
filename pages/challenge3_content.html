<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI-Powered Yoga Pose Challenge</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- MediaPipe Pose -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/pose.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.5/drawing_utils.js"></script>

<style>
body { font-family: sans-serif; background: #f0fdf4; display: flex; flex-direction: column; align-items: center; padding: 20px; }
video, canvas { border: 2px solid green; border-radius: 10px; }
.pose-photo { max-width: 200px; border: 2px solid #006400; border-radius: 10px; margin-bottom: 10px; }
</style>
</head>
<body>

<h1 class="text-3xl font-bold text-green-700 mb-4">AI-Powered Yoga Pose Challenge</h1>

<div class="text-center mb-4">
<h2 class="text-xl font-semibold text-green-800">Pose to Copy:</h2>
<p id="currentPoseName" class="text-2xl font-bold text-green-600">Click Start</p>
<img id="posePhoto" class="pose-photo" src="" alt="Reference Pose">
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
  <div class="text-center">
    <h3 class="font-semibold text-green-700 mb-2">Your Camera</h3>
    <video id="video" autoplay playsinline muted width="640" height="480"></video>
  </div>

  <div class="text-center">
    <h3 class="font-semibold text-green-700 mb-2">Pose Detection + Score</h3>
    <canvas id="overlay" width="640" height="480"></canvas>
    <p id="scoreDisplay" class="text-xl font-bold text-green-700 mt-2">Score: -</p>
  </div>
</div>

<div class="flex gap-4 mb-6">
<button id="startBtn" class="bg-green-600 text-white px-6 py-2 rounded-xl hover:bg-green-700">Start Pose</button>
<button id="screenshotBtn" class="bg-green-500 text-white px-6 py-2 rounded-xl hover:bg-green-600">Take Screenshot</button>
</div>

<script>
// -------- Reference poses --------
const referencePoses = [
  { name: "Mountain Pose", photo: "assets/images/mountainpose.jpg", landmarks: [] },
  { name: "Tree Pose", photo: "assets/images/treepose.jpg", landmarks: [] },
  { name: "Downward-Facing Dog", photo: "assets/images/downwardfacingdog.jpg", landmarks: [] },
  { name: "Warrior I", photo: "assets/images/warriori.jpg", landmarks: [] },
  { name: "Warrior II", photo: "assets/images/warriorii.jpg", landmarks: [] }
];

let currentReference = null;

// DOM elements
const video = document.getElementById("video");
const canvas = document.getElementById("overlay");
const ctx = canvas.getContext("2d");
const scoreDisplay = document.getElementById("scoreDisplay");
const posePhoto = document.getElementById("posePhoto");

// -------- MediaPipe setup --------
const pose = new Pose({
  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/${file}`
});
pose.setOptions({modelComplexity:1, smoothLandmarks:true});
pose.onResults(results => {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(results.poseLandmarks){
    drawConnectors(ctx, results.poseLandmarks, POSE_CONNECTIONS, {color:'#006400', lineWidth:2});
    drawLandmarks(ctx, results.poseLandmarks, {color:'#008000', lineWidth:1});
  }
  // Placeholder score for testing
  scoreDisplay.innerText = "Score: " + Math.floor(Math.random()*101);
});

// -------- Start camera --------
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject = stream;
    video.onloadedmetadata = () => {
      video.play();
      function loop(){ pose.send({image: video}); requestAnimationFrame(loop); }
      loop();
    };
  } catch(e){ console.error("Camera error", e); alert("Camera access denied."); }
}

// -------- Start challenge --------
document.getElementById("startBtn").addEventListener("click", () => {
  const index = Math.floor(Math.random()*referencePoses.length);
  currentReference = referencePoses[index];
  document.getElementById("currentPoseName").innerText = currentReference.name;
  posePhoto.src = currentReference.photo;
  startCamera();
});

// -------- Screenshot --------
document.getElementById("screenshotBtn").addEventListener("click", () => {
  const tempCanvas = document.createElement("canvas");
  tempCanvas.width = video.videoWidth;
  tempCanvas.height = video.videoHeight;
  const tempCtx = tempCanvas.getContext("2d");
  tempCtx.drawImage(video, 0, 0);
  tempCtx.drawImage(canvas, 0, 0);
  const dataUrl = tempCanvas.toDataURL("image/png");
  const a = document.createElement("a");
  a.href = dataUrl;
  a.download = "yoga_pose_capture.png";
  a.click();
});
</script>

</body>
</html>

